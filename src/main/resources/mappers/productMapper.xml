<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="com.oldtom.smartstock.mapper.ProductMapper">
  	

 	<select id="getProduct" parameterType="String" resultType="com.oldtom.smartstock.product.ProductVO">
		select *
		from product 
		where id = #{id}
 	</select>
 		
 
    <insert id="createProduct">
 	insert into product (name, price, months, role_id, role_name, reg_date)
 	values (#{name}, #{price}, #{months}, #{role_id}, #{role_name}, now())
 	</insert>
 	
  	<update id="updateProduct">
 	update product set name = #{name}, price = #{price}, months = #{months},
 					role_id = #{role_id}, role_name = #{role_name}
 	where id = #{id}
 	</update>
 	
 		
 	<delete id="deleteProduct">
 	delete from product where id = #{id}
 	</delete>

    <sql id="includeProduct">

         <if test="searchKeyword!=null and searchKeyword!='' and searchType!=''">
         	 
              <foreach item="item" index="index" collection="searchTypeArr" separator=" OR " open="WHERE (" close=")">
                     ${item} LIKE CONCAT('%', #{searchKeyword},'%' )
              </foreach>
        </if>               
    </sql>

    <select id="getProductCount" resultType="Integer" parameterType="com.oldtom.smartstock.common.SearchVO">
        SELECT COUNT(*)
          FROM product
         <include refid="includeProduct"/>
    </select> 
    
    <select id="getProductList" resultType="com.oldtom.smartstock.product.ProductVO" parameterType="com.oldtom.smartstock.common.SearchVO">
        SELECT *
          FROM product a
         <include refid="includeProduct"/>
         ORDER BY ID DESC 
         LIMIT ${rowStart-1}, 10
    </select> 				 		
 
     <select id="getProductListByRole" resultType="com.oldtom.smartstock.product.ProductVO" parameterType="String">
        SELECT *
        FROM product a
        WHERE role_id = #{role_id}
        ORDER BY price 
    </select> 
 
 </mapper>